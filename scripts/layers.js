// -----------------------------------------------------------------------------
// creation of layer id arrays
// -----------------------------------------------------------------------------

// array holding data layer ids of ada layers
var layer_ids_ada_data = [
    'population_ada', 
    'recent_immigration_ada', 
    'visible_minority_ada', 
    'aboriginal_identity_ada',
    'med_income_ada', 
    'lim_at_ada',
    'unemployment_ada',
    'tenant30_ada',
    'child_poverty_ada'
];

// array holding no data layer ids of ada layers
var layer_ids_ada_null = [
    'population_ada_null', 
    'recent_immigration_ada_null', 
    'visible_minority_ada_null', 
    'aboriginal_identity_ada_null',
    'med_income_ada_null', 
    'lim_at_ada_null',
    'unemployment_ada_null',
    'tenant30_ada_null',
    'child_poverty_ada_null'
];

// array holding data layer ids of fed layers
var layer_ids_fed_data = [
    'population_fed',
    'recent_immigration_fed', 
    'visible_minority_fed',
    'aboriginal_identity_fed',
    'med_income_fed', 
    'lim_at_fed',
    'unemployment_fed',
    'tenant30_fed',
    'child_poverty_fed'
];

// array holding no data layer ids of fed layers
var layer_ids_fed_null = [
    'population_fed_null', 
    'recent_immigration_fed_null',
    'visible_minority_fed_null',
    'aboriginal_identity_fed_null',
    'med_income_fed_null', 
    'lim_at_fed_null',
    'unemployment_fed_null',
    'tenant30_fed_null',
    'child_poverty_fed_null'
];

// array holding all ids of hover and click layers
var layer_ids_hover_click = [
    'fed_hover_fill',
    'fed_click_fill',
    'fed_hover_border',
    'fed_click_border',
    'ada_hover_fill',
    'ada_click_fill',
    'ada_hover_border',
    'ada_click_border',
];

// -----------------------------------------------------------------------------
// values for within each layer

var max_zoom_ada = 22;
var min_zoom_ada = 0;

var opacity_1_stop_ada = 0;
var opacity_2_stop_ada = 7;
var opacity_3_stop_ada = 8;
var opacity_4_stop_ada = 10;

var opacity_1_value_ada = 0;
var opacity_2_value_ada = 0.5;
var opacity_3_value_ada = 0.7;
var opacity_4_value_ada = 0.8;

var max_zoom_fed = 22;
var min_zoom_fed = 0;

var opacity_1_stop_fed = 0;
var opacity_2_stop_fed = 7;
var opacity_3_stop_fed = 8;
var opacity_4_stop_fed = 10;

var opacity_1_value_fed = 0.9;
var opacity_2_value_fed = 0.75;
var opacity_3_value_fed = 0.5;
var opacity_4_value_fed = 0;


// colour palette
// all layer colours defined in these variables and the hover, click, and points below
var white = '#ffffff';
var grey = '#D0D0D0';
var colour_1 = '#fefbf3';
var colour_2 = '#feeec2';
var colour_3 = '#fee190';
var colour_4 = '#fed461';
var colour_5 = '#fed050';
var colour_6 = '#fecb3f';
var colour_7 = '#f3af36';
var colour_8 = '#dc8234';
var colour_9 = '#c65431';
var colour_10 = '#af272f';

// for other points/layers
var basket_colour = '#167ba2';

var bank_colour_1 = '#cceaee';
var bank_colour_2 = '#99d5dd';
var bank_colour_3 = '#66c1cb';
var bank_colour_4 = '#33acba';
var bank_colour_5 = '#0097a9';

// for hovering and click layers
// hover layers
// line colours/opacity and line width, same for all
var hover_colour_border_true = 'rgba(73, 73, 73, 1)'; // previous grey
var hover_colour_border_false = 'rgba(73, 73, 73, 0)';
var hover_width = 1.25;

// opacity stops to be manipulated, different between fed and ada, same for hover and click
var opacity_1_stop_fed_hover = 0;
var opacity_2_stop_fed_hover = 9;
var opacity_3_stop_fed_hover = 10;

var opacity_1_value_fed_hover = 0.9;
var opacity_2_value_fed_hover = 0.8;
var opacity_3_value_fed_hover = 0;

var opacity_1_stop_ada_hover = 0;
var opacity_2_stop_ada_hover = 9.5;
var opacity_3_stop_ada_hover = 10;

var opacity_1_value_ada_hover = 0;
var opacity_2_value_ada_hover = 0;
var opacity_3_value_ada_hover = 0.9;


// line colours/opacity and line width, same for all
var click_colour_border_true = 'rgba(22, 123, 162, 1)'; // text blue

// var click_colour_border_true = 'rgba(85, 55, 55, 1)'; // previous grey
var click_colour_border_false = 'rgba(85, 55, 55, 0)';
var click_width = 1.25;

// -----------------------------------------------------------------------------
// geographies with all  attributes as sources
// -----------------------------------------------------------------------------
var add_sources = function(map) {
    // add each geography as a source from tileset within mapbox account to be added as layers

    // Aggregate dissemination areas w/ data
    // v6 jsparrow.32sgz8as
    map.addSource('ada', {
        'type': 'vector',
        'url': 'mapbox://' // Mapbox tileset source url
    });

    // v6 jsparrow.dhy1i62y
    map.addSource('fed', {
        'type': 'vector',
        'url': 'mapbox://' // Mapbox tileset source url
    });

    // food basket point costs
    map.addSource('food_basket', {
        'type': 'vector',
        'url': 'mapbox://' // Mapbox tileset source url
    });

    // food bank points
    map.addSource('food_bank', {
        'type': 'geojson',
        'data': food_bank_points, // variable defined in food_bank_points.js
        'cluster': true,
        'clusterMaxZoom': 12, // Max zoom to cluster points on
        'clusterRadius': 30 // Radius of each cluster when clustering points (defaults to 50)
    });

    // -----------------------------------------------------------------------------
    // for hovering & click; make sure sources are correct with updates and versions
    // v6
    map.addSource('ada_hover', {
        'type': 'vector',
        'url': 'mapbox://' // Mapbox tileset source url
    });

    // v6
    map.addSource('ada_click', {
        'type': 'vector',
        'url': 'mapbox://' // Mapbox tileset source url
    });

    // v6 jsparrow.dhy1i62y
    map.addSource('fed_hover', {
        'type': 'vector',
        'url': 'mapbox://' // Mapbox tileset source url
    });

    map.addSource('fed_click', {
        'type': 'vector',
        'url': 'mapbox://' // Mapbox tileset source url
    });

};
// -----------------------------------------------------------------------------

// -----------------------------------------------------------------------------
// add layers with 1st on load to be visible, all others visibility = none
// -----------------------------------------------------------------------------
// ada layers
var ada_layers = function(map) {
    // -----------------------------------------------------------------------------
    // population of adas
    map.addLayer({
        'id': 'population_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'population'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-js/issues/4410
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'population',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [500, colour_2],
                    [2500, colour_3],
                    [5000, colour_4],
                    [7500, colour_5],
                    [10000, colour_6],
                    [15000, colour_7],
                    [20000, colour_8],
                    [30000, colour_9],
                    [40000, colour_10]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada], 
                    [opacity_2_stop_ada, opacity_2_value_ada], 
                    [opacity_3_stop_ada, opacity_3_value_ada], 
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'population_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'population'],
        
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // recent_immigration of adas
    map.addLayer({
        'id': 'recent_immigration_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'recent_immigration'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'recent_immigration',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [0.25, colour_2],
                    [0.5, colour_3],
                    [1, colour_4],
                    [2.5, colour_5],
                    [5, colour_6],
                    [7.5, colour_7],
                    [10, colour_8],
                    [15, colour_9],
                    [25, colour_10]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'recent_immigration_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'recent_immigration'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // visible_minority of adas
    map.addLayer({
        'id': 'visible_minority_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'visible_minority'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'visible_minority',
                type: 'interval',
                stops: [
                    [0, white],
                    [1, colour_1],
                    [2.5, colour_2],
                    [5, colour_3],
                    [7.5, colour_4],
                    [12.5, colour_5],
                    [20, colour_6],
                    [25, colour_7],
                    [35, colour_8],
                    [50, colour_9],
                    [75, colour_10]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'visible_minority_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'visible_minority'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // aboriginal_identity of adas
    map.addLayer({
        'id': 'aboriginal_identity_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'aboriginal_identity'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'aboriginal_identity',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [0.5, colour_2],
                    [1, colour_3],
                    [2.5, colour_4],
                    [5, colour_5],
                    [10, colour_6],
                    [25, colour_7],
                    [50, colour_8],
                    [75, colour_9],
                    [95, colour_10]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'aboriginal_identity_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'aboriginal_identity'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    
    // -----------------------------------------------------------------------------
    // median income for adas
    map.addLayer({
        'id': 'med_income_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'median_income_house'], 
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'median_income_house',
                type: 'interval',
                stops: [
                    [10000, colour_10],
                    [20000, colour_9],
                    [40000, colour_8],
                    [50000, colour_7],
                    [60000, colour_6],
                    [65000, colour_5],
                    [75000, colour_4],
                    [90000, colour_3],
                    [100000, colour_2],
                    [150000, colour_1],
                    [200000, white]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'med_income_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'median_income_house'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');
    
    // -----------------------------------------------------------------------------
    // LIM-AT
    map.addLayer({
        'id': 'lim_at_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'lim_at'], 
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'lim_at',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [2.5, colour_2],
                    [5, colour_3],
                    [7.5, colour_4],
                    [10, colour_5],
                    [12.5, colour_6],
                    [15, colour_7],
                    [20, colour_8],
                    [25, colour_9],
                    [50, colour_10]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'lim_at_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'lim_at'],
        // to filter for null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    
    // -----------------------------------------------------------------------------
    // unemployment
    map.addLayer({
        'id': 'unemployment_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'unemployment'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'unemployment',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [4, colour_2],
                    [5, colour_3],
                    [6, colour_4],
                    [7, colour_5],
                    [8, colour_6],
                    [10, colour_7],
                    [15, colour_8],
                    [20, colour_9],
                    [30, colour_10]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'unemployment_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'unemployment'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');


    // -----------------------------------------------------------------------------
    // tenant30
    map.addLayer({
        'id': 'tenant30_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'tenant30'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'tenant30',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [10, colour_2],
                    [25, colour_3],
                    [30, colour_4],
                    [35, colour_5],
                    [38, colour_6],
                    [42, colour_7],
                    [45, colour_8],
                    [50, colour_9],
                    [75, colour_10]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'tenant30_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'tenant30'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // child_poverty of adas
    // filler layers for loop functions, no child poverty data for ADAs
    map.addLayer({
        'id': 'child_poverty_ada',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['has', 'child_poverty'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'child_poverty_ada_null',
        'source': 'ada',
        'source-layer': 'ADA_2016',
        'minzoom': min_zoom_ada,
        'maxzoom': max_zoom_ada,
        'type': 'fill',
        'filter': ['!has', 'child_poverty'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_ada, opacity_1_value_ada],
                    [opacity_2_stop_ada, opacity_2_value_ada],
                    [opacity_3_stop_ada, opacity_3_value_ada],
                    [opacity_4_stop_ada, opacity_4_value_ada]
                ]
            }
        }
    }, 'waterway-label');

}; // end of ada_layers function



// fed layers
var fed_layers = function (map) {
    // -----------------------------------------------------------------------------
    // fed population
    map.addLayer({
        'id': 'population_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'population'],
        
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'population',
                type: 'interval',
                stops: [
                    [0, white],
                    [27000, colour_1],
                    [42000, colour_2],
                    [76000, colour_3],
                    [88000, colour_4],
                    [98000, colour_5],
                    [106000, colour_6],
                    [113000, colour_7],
                    [119000, colour_8],
                    [125000, colour_9],
                    [136000, colour_10]
                ]

            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'population_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'population'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');
    
    // -----------------------------------------------------------------------------
    // fed recent immigration
    map.addLayer({
        'id': 'recent_immigration_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'recent_immigration'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'recent_immigration',
                type: 'interval',
                stops: [
                    [0, white],
                    [0.5, colour_1],
                    [0.75, colour_2],
                    [1.5, colour_3],
                    [2.5, colour_4],
                    [3.5, colour_5],
                    [5, colour_6],
                    [7, colour_7],
                    [10, colour_8],
                    [12, colour_9],
                    [20, colour_10]
                ]

            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'recent_immigration_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'recent_immigration'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // fed visible_minority
    map.addLayer({
        'id': 'visible_minority_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'visible_minority'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'visible_minority',
                type: 'interval',
                stops: [
                    [0, white],
                    [1, colour_1],
                    [2.5, colour_2],
                    [5, colour_3],
                    [7.5, colour_4],
                    [12.5, colour_5],
                    [20, colour_6],
                    [25, colour_7],
                    [35, colour_8],
                    [50, colour_9],
                    [75, colour_10]
                ]

            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'visible_minority_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'visible_minority'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // fed aboriginal_identity
    map.addLayer({
        'id': 'aboriginal_identity_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'aboriginal_identity'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'aboriginal_identity',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [0.5, colour_2],
                    [1, colour_3],
                    [2, colour_4],
                    [5, colour_5],
                    [10, colour_6],
                    [20, colour_7],
                    [50, colour_8],
                    [65, colour_9],
                    [75, colour_10]
                ]

            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'aboriginal_identity_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'aboriginal_identity'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');


    // -----------------------------------------------------------------------------
    // fed med income
    map.addLayer({
        'id': 'med_income_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'median_income_house'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'median_income_house',
                type: 'interval',
                stops: [
                    [10000, colour_10],
                    [20000, colour_9],
                    [40000, colour_8],
                    [50000, colour_7],
                    [60000, colour_6],
                    [65000, colour_5],
                    [75000, colour_4],
                    [90000, colour_3],
                    [100000, colour_2],
                    [150000, colour_1],
                    [200000, white]
                ]

            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'med_income_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'median_income_house'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // fed LIM-AT
    map.addLayer({
        'id': 'lim_at_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'lim_at'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'lim_at',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [2.5, colour_2],
                    [5, colour_3],
                    [7.5, colour_4],
                    [10, colour_5],
                    [12.5, colour_6],
                    [15, colour_7],
                    [20, colour_8],
                    [25, colour_9],
                    [50, colour_10]
                ]

            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'lim_at_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'lim_at'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // fed child_poverty
    map.addLayer({
        'id': 'child_poverty_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'child_poverty_2017'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'child_poverty_2017',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [2.5, colour_2],
                    [5, colour_3],
                    [7.5, colour_4],
                    [10, colour_5],
                    [12.5, colour_6],
                    [15, colour_7],
                    [20, colour_8],
                    [25, colour_9],
                    [50, colour_10]
                ]

            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'child_poverty_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'child_poverty_2017'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // fed unemployment
    map.addLayer({
        'id': 'unemployment_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'unemployment'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'unemployment',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [4, colour_2],
                    [5, colour_3],
                    [6, colour_4],
                    [7, colour_5],
                    [8, colour_6],
                    [10, colour_7],
                    [15, colour_8],
                    [20, colour_9],
                    [30, colour_10]
                ]

            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'unemployment_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'unemployment'],
        // to filter out null values https://github.com/mapbox/mapbox-gl-style-spec/issues/364
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    // -----------------------------------------------------------------------------
    // tenant30
    map.addLayer({
        'id': 'tenant30_fed',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['has', 'tenant30'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': {
                property: 'tenant30',
                type: 'interval',
                stops: [
                    [0, colour_1],
                    [10, colour_2],
                    [25, colour_3],
                    [30, colour_4],
                    [35, colour_5],
                    [38, colour_6],
                    [42, colour_7],
                    [45, colour_8],
                    [50, colour_9],
                    [75, colour_10]
                ]
            },
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'tenant30_fed_null',
        'source': 'fed',
        'source-layer': 'FED_2016',
        'minzoom': min_zoom_fed,
        'maxzoom': max_zoom_fed,
        'type': 'fill',
        'filter': ['!has', 'tenant30'],
        
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'fill-outline-color': white,
            'fill-color': grey,
            'fill-opacity': {
                stops: [
                    [opacity_1_stop_fed, opacity_1_value_fed],
                    [opacity_2_stop_fed, opacity_2_value_fed],
                    [opacity_3_stop_fed, opacity_3_value_fed],
                    [opacity_4_stop_fed, opacity_4_value_fed]
                ]
            }
        }
    }, 'waterway-label');

}; // end of fed_layers funciton

var food_bank_layer = function (map) {
    map.addLayer({
        'id': 'food_bank_cluster',
        'type': 'circle',
        'source': 'food_bank',
        'layout': {
            'visibility': 'none'
        },
        'filter': ["has", "point_count"],
        'paint': {
            // Use step expressions (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-step)
            // with steps to implement three types of circles:
            "circle-color": [
                "step",
                ["get", "point_count"],
                bank_colour_1,
                15,
                bank_colour_2,
                50,
                bank_colour_3,
                100,
                bank_colour_4
            ],
            
            "circle-radius": [
                "step",
                ["get", "point_count"],
                8,
                15,
                12, // px
                25, // count
                15, // px
                50, // count
                20, // px
                100, // count
                25 // px
            ]
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'food_bank_cluster_count',
        'type': 'symbol',
        'source': 'food_bank',
        'filter': ['has', 'point_count'],
        'layout': {
            'visibility': 'none',
            'text-field': '{point_count_abbreviated}',
            'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
            'text-size': 10
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'food_bank_unclustered_point',
        'type': 'circle',
        'source': 'food_bank',
        'layout': {
            'visibility': 'none'
        },
        'filter': ['!', ['has', 'point_count']],
        'paint': {
            'circle-color': '#0097a9',
            'circle-radius': 3,
            'circle-stroke-width': 0.5,
            'circle-stroke-color': white
        }
    }, 'waterway-label');


}; // end of food_bank_layer funciton


var food_basket_layer = function (map) {
    
    map.addLayer({
        'id': 'food_basket',
        'type': 'circle',
        'source': 'food_basket',
        'source-layer': 'FBC_food_basket-a46xhc',
        'layout': {
            'visibility': 'none'
        },
        'paint': {
            'circle-radius': [
                '/',
                ['-', ['number', ['get', 'march_18']], 340], // range is 341 - 495
                10
            ],
            'circle-opacity': 0.8,
            'circle-color': [
                'step',
                ['get', 'march_18'],
                bank_colour_1,
                350,
                bank_colour_2,
                375,
                bank_colour_3,
                425,
                bank_colour_4,
                475,
                bank_colour_5
            ]
            
        }
    }, 'waterway-label');
};

var hover_layers = function(map) {
    // fed hover layers
    map.addLayer({
        'id': 'fed_hover_fill',
        'source': 'fed_hover',
        'source-layer': 'FED_2016',
        'type': 'fill',
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'fill-opacity': 0
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'fed_hover_border',
        'source': 'fed_hover',
        'source-layer': 'FED_2016',
        'type': 'line',
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'line-color': ['case',
                ['boolean', ['feature-state', 'hover'], false],
                hover_colour_border_true,
                hover_colour_border_false
            ],
            'line-width': hover_width,
            'line-opacity': {
                stops: [
                    [opacity_1_stop_fed_hover, opacity_1_value_fed_hover],
                    [opacity_2_stop_fed_hover, opacity_2_value_fed_hover],
                    [opacity_3_stop_fed_hover, opacity_3_value_fed_hover]
                ]
            }
        }
    }, 'waterway-label');

    // ada hover layers
    map.addLayer({
        'id': 'ada_hover_fill',
        'source': 'ada_hover',
        'source-layer': 'ADA_2016',
        'type': 'fill',
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'fill-opacity': 0
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'ada_hover_border',
        'source': 'ada_hover',
        'source-layer': 'ADA_2016',
        'type': 'line',
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'line-color': ['case',
                ['boolean', ['feature-state', 'hover'], false],
                hover_colour_border_true,
                hover_colour_border_false
            ],
            'line-width': hover_width,
            'line-opacity': {
                stops: [
                    [opacity_1_stop_ada_hover, opacity_1_value_ada_hover],
                    [opacity_2_stop_ada_hover, opacity_2_value_ada_hover],
                    [opacity_3_stop_ada_hover, opacity_3_value_ada_hover]
                ]
            }
        }
    }, 'waterway-label');
};

var click_layers = function (map) {
    // fed click layers
    map.addLayer({
        'id': 'fed_click_fill',
        'source': 'fed_click',
        'source-layer': 'FED_2016',
        'type': 'fill',
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'fill-opacity': 0
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'fed_click_border',
        'source': 'fed_click',
        'source-layer': 'FED_2016',
        'type': 'line',
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'line-color': ['case',
                ['boolean', ['feature-state', 'click'], false],
                click_colour_border_true,
                click_colour_border_false
            ],
            'line-width': click_width,
            'line-opacity': {
                stops: [
                    [opacity_1_stop_fed_hover, opacity_1_value_fed_hover],
                    [opacity_2_stop_fed_hover, opacity_2_value_fed_hover],
                    [opacity_3_stop_fed_hover, opacity_3_value_fed_hover]
                ]
            }
        }
    }, 'waterway-label');

    // ada click layers
    map.addLayer({
        'id': 'ada_click_fill',
        'source': 'ada_click',
        'source-layer': 'ADA_2016',
        'type': 'fill',
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'fill-opacity': 0
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'ada_click_border',
        'source': 'ada_click',
        'source-layer': 'ADA_2016',
        'type': 'line',
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            'line-color': ['case',
                ['boolean', ['feature-state', 'click'], false],
                click_colour_border_true,
                click_colour_border_false
            ],
            'line-width': click_width,
            'line-opacity': {
                stops: [
                    [opacity_1_stop_ada_hover, opacity_1_value_ada_hover],
                    [opacity_2_stop_ada_hover, opacity_2_value_ada_hover],
                    [opacity_3_stop_ada_hover, opacity_3_value_ada_hover]
                ]
            }
        }
    }, 'waterway-label');
};
